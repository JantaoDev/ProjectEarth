# Project Earth - документация для разрабочиков

## 1. Общие определения

Единицей знаний в проекте Земля является *Объект*. Объект содержит информацию о себе (заголовок, описание, дата создания, автор) и об отношении к другим объектам.

Совокупность всех объектов формируется в *Дерево объектов*.

Все объекты делятся на *Контейнеры* и *Документы*.

*Контейнер* - объект, который служит для группировки других объектов.

*Документ* - объект, который служит для хранения информации. Документ содержит *Версии документа*. *Версия документа* содержит информацию о локали, к которой относится версия документа, дате создания, авторе.

## 2. Типы объектов и их отношение

Основные типы объектов, их назначение, типы объектов, которые можно хранить внутри объекта:

| Тип объекта | Назначение   | Может содержать типы объектов |
| ----------- | ------------ | ----------------------------- |
| Базовый контейнер | Для группировки всех мастерских и поселений | Мастерская или Поселение |
| Мастерская | Содержит документы и прочие объекты мастерской | Любые документы |
| Поселение | Содержит поместья из одного поселения | Поместье |
| Поместье | Содержит информацию, документы о поместьи | Любые документы |
| Внутренний документ | Документ, редактируемый на сайте в онлайн-редакторе | |
| Файл | Документ, закачиваемый на сайт | |
| Документ Google Docs | Документ в облаке Google Docs | |

## 3. Контроль доступа

У каждого объекта есть список поддерживаемых операций: просмотр, создание, редактирование, удаление, настройка и т.д.

Контроль доступа к объекту осуществляется по группам пользователей (администраторы, авторизованные пользователи, все пользователи), ролям (роли задаются произвольно для каждого объекта), пользователям.
То есть при контроле доступа проверяются разрешения для группы, к которой принадлежит пользователь, для всех ролей пользователя для этого объекта, и личные разрешения пользователя, если они заданы. 
Если хотя бы одно разрешение установлено, то доступ разрешается.

Параметры контроля доступа задаются для каждого объекта отдельно, однако при их установке есть возможность применить параметры ко всем вложенным объектам. Создаваемый объект имеет параметры контроля доступа родителя.

Роли пользователей задаются произвольно для каждого объекта. Эти роли также действуют для всех вложенных объектов. 
Пример: для мастерской задана роль ученика, эта же роль будет действовать для документов мастерской. 
Есть возможность для вложенного объекта задать дополнительную роль.

Существует три группы пользователей: Администраторы, Авторизованные пользователи, Все пользователи. 
Пользователи, отмеченные как администраторы, принадлежат всем трём группам. 
Авторизованные пользователи принадлежат группам Авторизованные пользователии и Все пользователи.
Неавторизованные пользователи принадлежат группе Все пользователи.

Администраторы имеют доступ ко всем операциям.

Пример таблицы настройки контроля доступа:

|     | Просмотр | Создание | Редактирование | Удаление | Настройка |
| --- | -------- | -------- | -------------- | -------- | --------- |
| Все пользователи | | | | | |
| Авторизованные пользователи  | | | | | |
| Мастера | | | | | |
| Подмастерья | | | | | |
| Ученики  | | | | | |
| Иванов Иван Иванович | | | | | |
| Петров Петр Петрович | | | | | |

## 4. Описание классов объектов

### 4.1. Описание класса объекта (AbstractObject)

Свойства класса (все свойства закрыты, обращение через геттеры/сеттеры):

- заголовок (titleRu, titleEn)
- описание (descriptionRu, descriptionEn)
- дата создания (createdAt)
- дата модификаци (modifiedAt)
- автор (author)
- родитель в дереве объектов (parent)

Дополнительно методы класса:

- получить список потомков в дереве объектов (getChildrens)
- сохранить изменения (save)
- создать объект потомка (createChildren)
- проверить доступ пользователя к объекту на чтение, запись, удаление или другую операцию (checkPermission)

### 4.2. Описание класса контейнера

Наследует все свойства и методы класса объекта.

### 4.3. Описание класса документа

Наследует все свойства и методы класса объекта.

Дополнительные методы класса:

- геттеры/сеттеры дополнительных свойств класса, которые зависят от типа документа, например для внутреннего объекта это контент
- получить номер текущей версии документа (getCurrentVersionId)
- получить свойства текущей версии документа - номер, локаль, дата создания, автор (getCurrentVersion)
- получить список версий документа (getVersions)
- переключится на другую версию документа по её номеру (setCurrentVersion)
- переключится на другую версию документа по её свойствам (setCurrentVersionByParameters)

## 5. Реестр объектов

Получить объект по url, id или другим параметрам можно с помощью сервиса реестра объектов.

## 6. Комментарии

К каждому объекту можно оставлять комментарии.

## 7. События и оповещение
















